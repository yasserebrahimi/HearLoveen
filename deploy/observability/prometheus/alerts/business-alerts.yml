groups:
- name: business_alerts
  interval: 1m
  rules:
  # Low Audio Processing Success Rate
  - alert: LowAudioProcessingSuccessRate
    expr: |
      sum(rate(audio_processing_total{status="success"}[10m]))
      /
      sum(rate(audio_processing_total[10m]))
      < 0.90
    for: 10m
    labels:
      severity: critical
      component: ml
    annotations:
      summary: "Low audio processing success rate"
      description: "Only {{ $value | humanizePercentage }} of audio submissions are being processed successfully (threshold: 90%)"

  # ML Model Inference Latency High
  - alert: MLInferenceLatencyHigh
    expr: |
      histogram_quantile(0.95,
        sum(rate(ml_inference_duration_seconds_bucket[5m])) by (le)
      ) > 5.0
    for: 5m
    labels:
      severity: warning
      component: ml
    annotations:
      summary: "ML inference latency is high"
      description: "95th percentile inference time is {{ $value }}s (threshold: 5s)"

  # No Audio Submissions
  - alert: NoAudioSubmissions
    expr: |
      sum(increase(audio_submissions_total[1h])) == 0
    for: 2h
    labels:
      severity: warning
      component: business
    annotations:
      summary: "No audio submissions received"
      description: "No audio submissions in the last 2 hours - possible issue with client app or user engagement"

  # High Pronunciation Score Variance
  - alert: HighPronunciationScoreVariance
    expr: |
      stddev_over_time(pronunciation_score[1h]) > 0.3
    for: 30m
    labels:
      severity: info
      component: ml
    annotations:
      summary: "High variance in pronunciation scores"
      description: "Pronunciation score standard deviation is {{ $value }} - may indicate model instability"

  # Low User Engagement
  - alert: LowUserEngagement
    expr: |
      sum(increase(user_active_sessions[24h])) < 10
    for: 1h
    labels:
      severity: info
      component: business
    annotations:
      summary: "Low user engagement detected"
      description: "Only {{ $value }} active user sessions in the last 24 hours"

  # Failed Notifications High
  - alert: FailedNotificationsHigh
    expr: |
      sum(rate(notifications_total{status="failed"}[10m]))
      /
      sum(rate(notifications_total[10m]))
      > 0.10
    for: 10m
    labels:
      severity: warning
      component: notifications
    annotations:
      summary: "High notification failure rate"
      description: "{{ $value | humanizePercentage }} of notifications are failing"

  # Therapist Response Time Slow
  - alert: TherapistResponseTimeSlow
    expr: |
      avg(therapist_response_time_hours) > 48
    for: 1h
    labels:
      severity: info
      component: business
    annotations:
      summary: "Therapist response time is slow"
      description: "Average therapist response time is {{ $value }} hours (SLA: 48h)"
